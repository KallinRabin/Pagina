<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voz Ciudadana - Uruguay</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Iconos FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Cropper.js para recorte profesional de fotos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
</head>

<body>

    <div class="admin-indicator">MODO ADMINISTRADOR ACTIVO</div>

    <header>
        <div class="header-container">
            <div class="logo" onclick="location.reload()">
                <i class="fas fa-bullhorn"></i> Voz<b>Ciudadana</b>
            </div>

            <nav class="nav-links">
                <div id="auth-zone" class="auth-buttons">
                    <button class="btn-login" onclick="abrirAuth(); switchAuth('log')">Iniciar Sesi贸n</button>
                    <button class="btn-register" onclick="abrirAuth(); switchAuth('reg')">Registrarse</button>
                </div>
            </nav>
        </div>
    </header>

    <section class="hero">
        <h1>Tu voz transforma tu comunidad</h1>
        <p>Reporta quejas, propone ideas o comparte noticias de tu departamento.</p>
    </section>

    <div class="filter-zone">
        <div class="selector-group">
            <i class="fas fa-map-marker-alt"></i>
            <select id="main-dept-filter" onchange="cambiarDepartamento()">
                <option value="todos">Todo el Uruguay</option>
            </select>
        </div>

        <div class="category-nav">
            <button class="cat-btn active" onclick="filtrarCategoria('todas')" data-cat="todas">Todo</button>
            <button class="cat-btn" onclick="filtrarCategoria('Queja')" data-cat="Queja">Quejas</button>
            <button class="cat-btn" onclick="filtrarCategoria('Idea')" data-cat="Idea">Ideas</button>
            <button class="cat-btn" onclick="filtrarCategoria('Noticia')" data-cat="Noticia">Noticias</button>
        </div>
    </div>

    <div class="container">

        <div class="action-grid">
            <div class="card card-queja" onclick="abrirModal('Queja')">
                <div class="card-icon"></div>
                <h3>Denunciar</h3>
                <p>驴Algo no funciona? Rep贸rtalo aqu铆.</p>
            </div>
            <div class="card card-idea" onclick="abrirModal('Idea')">
                <div class="card-icon"></div>
                <h3>Proponer</h3>
                <p>Comparte una idea para mejorar tu zona.</p>
            </div>
            <div class="card card-noticia" onclick="abrirModal('Noticia')">
                <div class="card-icon"></div>
                <h3>Informar</h3>
                <p>Publica una noticia o evento local.</p>
            </div>
        </div>

        <div id="admin-dashboard" class="status-summary" style="display: none;">
        </div>

        <div id="feed-container">
            <div style="text-align:center; padding:20px;">Cargando publicaciones...</div>
        </div>
    </div>

    <div id="postModal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">Nueva Publicaci贸n</h2>
            <form id="postForm">
                <input type="hidden" id="post-type">

                <div class="input-group">
                    <label>T铆tulo</label>
                    <input type="text" id="post-titulo" placeholder="驴Qu茅 est谩 pasando?" required>
                </div>

                <div class="input-group">
                    <label>Contenido / Detalles</label>
                    <textarea id="post-contenido" rows="4" placeholder="Describe la situaci贸n..." required></textarea>
                </div>

                <div class="input-group">
                    <label>Departamento</label>
                    <select id="post-dept" required></select>
                </div>

                <div class="input-group">
                    <label><i class="fas fa-paperclip"></i> Adjuntar Multimedia (Im谩genes, Video o PDF)</label>
                    <input type="file" id="post-files" multiple accept="image/*,video/*,application/pdf">
                    <small style="color: #666;">M谩ximo 5MB por sesi贸n de navegaci贸n.</small>
                </div>

                <div class="input-group" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                    <input type="checkbox" id="post-anonimo" style="width:auto;">
                    <label for="post-anonimo" style="margin:0;">Publicar de forma an贸nima</label>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="cerrarModal()">Cancelar</button>
                    <button type="submit" class="btn-submit">Publicar Ahora</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast-container"></div>

    <div id="authModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div style="text-align:right;">
                <span style="cursor:pointer; font-size:1.5rem;" onclick="cerrarAuth()">&times;</span>
            </div>

            <div id="auth-step-1">
                <h2>Ingreso / Registro</h2>
                <p>Ingresa tu correo para recibir un c贸digo de acceso.</p>
                <div class="input-group">
                    <input type="email" id="auth-email" placeholder="tu@email.com" required style="text-align:center;">
                </div>
                <button class="btn-submit" onclick="enviarCodigoAuth()" style="width: 100%;">Enviar C贸digo</button>
            </div>

            <div id="auth-step-2" style="display:none;">
                <h2>Verificar C贸digo</h2>
                <p>Hemos enviado un c贸digo a <b id="display-email"></b></p>
                <div class="input-group">
                    <input type="text" id="auth-code" placeholder="123456" maxlength="6"
                        style="text-align:center; letter-spacing: 5px; font-size: 1.5rem;">
                </div>
                <button class="btn-submit" onclick="verificarCodigoAuth()" style="width: 100%;">Entrar</button>
                <p style="font-size:0.8rem; margin-top:10px; cursor:pointer; color:blue;" onclick="resetAuth()">Volver /
                    Reenviar</p>
            </div>
        </div>
    </div>

    <!-- Modal de Perfil Profesional -->
    <div id="profileModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div style="text-align:right;">
                <span style="cursor:pointer; font-size:1.5rem;" onclick="cerrarProfile()">&times;</span>
            </div>
            <h2 style="text-align:center; margin-bottom:20px;">Gestionar Perfil</h2>

            <div style="text-align:center; margin-bottom:25px; position:relative;">
                <img id="profile-preview" src="https://ui-avatars.com/api/?name=User&background=random"
                    style="width:120px; height:120px; border-radius:50%; object-fit:cover; border:4px solid var(--primary); display:block; margin:0 auto 10px auto; box-shadow:0 6px 15px rgba(0,0,0,0.15);">

                <div style="display:flex; justify-content:center; gap:10px;">
                    <label for="profile-file"
                        style="cursor:pointer; color:var(--primary); font-weight:bold; font-size:0.8rem; background:#f0f7ff; padding:8px 15px; border-radius:20px; border:1px solid #cce3ff;">
                        <i class="fas fa-camera"></i> Subir/Cambiar
                    </label>
                    <button id="btn-delete-pfp" onclick="eliminarFotoPerfil()"
                        style="cursor:pointer; color:#dc3545; font-weight:bold; font-size:0.8rem; background:#fff5f5; padding:8px 15px; border-radius:20px; border:1px solid #ffd8d8;">
                        <i class="fas fa-trash"></i> Quitar
                    </button>
                </div>
                <input type="file" id="profile-file" accept="image/*" style="display:none;"
                    onchange="initCropper(this)">
            </div>

            <div class="input-group">
                <label>Nombre P煤blico</label>
                <input type="text" id="profile-name" placeholder="Tu nombre art铆stico o real">
            </div>

            <div class="input-group">
                <label>Departamento de Residencia</label>
                <select id="profile-dept" style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
                    <option value="">Selecciona tu departamento</option>
                    <option value="Artigas">Artigas</option>
                    <option value="Canelones">Canelones</option>
                    <option value="Cerro Largo">Cerro Largo</option>
                    <option value="Colonia">Colonia</option>
                    <option value="Durazno">Durazno</option>
                    <option value="Flores">Flores</option>
                    <option value="Florida">Florida</option>
                    <option value="Lavalleja">Lavalleja</option>
                    <option value="Maldonado">Maldonado</option>
                    <option value="Montevideo">Montevideo</option>
                    <option value="Paysand煤">Paysand煤</option>
                    <option value="R铆o Negro">R铆o Negro</option>
                    <option value="Rivera">Rivera</option>
                    <option value="Rocha">Rocha</option>
                    <option value="Salto">Salto</option>
                    <option value="San Jos茅">San Jos茅</option>
                    <option value="Soriano">Soriano</option>
                    <option value="Tacuaremb贸">Tacuaremb贸</option>
                    <option value="Treinta y Tres">Treinta y Tres</option>
                </select>
            </div>

            <div class="input-group">
                <label>Email de Usuario</label>
                <input type="text" id="profile-email" disabled style="background:#f9f9f9; color:#888;">
            </div>

            <!-- Secci贸n de Nivel y XP -->
            <div id="profile-level-section"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:12px; padding:20px; margin:15px 0; text-align:center; color:white;">
                <div style="font-size:2.5rem;" id="profile-insignia"></div>
                <div style="font-size:1.2rem; font-weight:bold; margin:5px 0;" id="profile-nivel-nombre">Ciudadano
                    Novato</div>
                <div style="font-size:0.9rem; opacity:0.9;">Nivel <span id="profile-nivel-num">1</span></div>
                <div style="margin-top:15px;">
                    <div style="background:rgba(255,255,255,0.3); border-radius:10px; height:12px; overflow:hidden;">
                        <div id="profile-xp-bar"
                            style="background:#fff; height:100%; width:0%; transition:width 0.5s ease;"></div>
                    </div>
                    <div style="font-size:0.8rem; margin-top:5px;">
                        <span id="profile-xp-actual">0</span> / <span id="profile-xp-siguiente">40</span> XP
                    </div>
                </div>
            </div>

            <button class="btn-submit" onclick="guardarPerfil()"
                style="width:100%; padding:12px; font-size:1rem;">Guardar Perfil</button>
        </div>
    </div>

    <!-- Modal para Recortar Imagen -->
    <div id="cropperModal" class="modal" style="z-index: 6000;">
        <div class="modal-content" style="max-width: 500px;">
            <h3>Ajustar Foto de Perfil</h3>
            <div style="max-height: 400px; overflow: hidden; margin-bottom: 20px;">
                <img id="cropper-image" style="max-width: 100%;">
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="cerrarCropper()">Cancelar</button>
                <button class="btn-submit" onclick="recortarYGuardar()">Recortar y Aplicar</button>
            </div>
        </div>
    </div>


    <!-- Modal de Confirmaci贸n -->
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width:350px; text-align:center;">
            <i class="fas fa-exclamation-circle" style="font-size:3rem; color: #dc3545; margin-bottom:15px;"></i>
            <h3 id="confirm-title" style="margin-top:0;">驴Est谩s seguro?</h3>
            <p id="confirm-msg">Esta acci贸n no se puede deshacer.</p>
            <div style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
                <button class="btn-cancel" onclick="cerrarConfirm()" style="margin:0">Cancelar</button>
                <button id="confirm-btn-yes" class="btn-submit"
                    style="background: #dc3545; border:none;">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Contenedor para Hover Card (Tooltip de usuario) -->
    <div id="user-hover-card" class="user-hover-card"></div>

    <script src="js/app.js"></script>
</body>

</html>